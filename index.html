<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Producción</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h2 class="titulo-formulario">REGISTRO DE PRODUCCIÓN CAUCHOS JTORRES</h2>

        <form id="registroForm">
          <label for="operario">Nombre del operario:</label>
          <input type="text" id="operario" name="operario" required>

          <label for="referencias">Referencias (una por línea):</label>
          <textarea id="referencias" name="referencias" rows="3" required></textarea>

          <label for="cantidades">Cantidades (una por línea, en el mismo orden):</label>
          <textarea id="cantidades" name="cantidades" rows="3" required></textarea>

          <!-- Aquí se generarán los bloques dinámicos -->
          <div id="bloquesDañados"></div>

          <label for="anomalia">¿Alguna anomalía?</label>
          <select id="anomalia" name="anomalia">
            <option value="">Seleccionar</option>
            <option value="Sí">Sí</option>
            <option value="No">No</option>
          </select>

          <label for="descripcionAnomalia">Descripción de la anomalía:</label>
          <textarea id="descripcionAnomalia" name="descripcionAnomalia" rows="3"></textarea>

          <button type="submit">Enviar</button>
        </form>

        <p id="mensajeExito" class="hidden">¡Gracias DIEGO! Registro enviado con éxito ✅</p>
    </div>

    <script src="script.js"></script>
</body>
</html>

<script>
document.getElementById("referencias").addEventListener("input", generarBloquesDañados);

function generarBloquesDañados() {
  const referencias = document.getElementById("referencias").value.trim().split("\n").filter(r => r);
  const contenedor = document.getElementById("bloquesDañados");
  contenedor.innerHTML = "";

  referencias.forEach((ref, index) => {
    const div = document.createElement("div");
    div.innerHTML = `
      <h3>Empaques dañados - ${ref}</h3>
      <label>Burbuja:</label><input type="number" min="0" name="burbuja-${index}" value="0">
      <label>Roto:</label><input type="number" min="0" name="roto-${index}" value="0">
      <label>Crudo:</label><input type="number" min="0" name="crudo-${index}" value="0">
      <label>Quemado:</label><input type="number" min="0" name="quemado-${index}" value="0">
      <label>Otro:</label><input type="number" min="0" name="otro-${index}" value="0">
    `;
    contenedor.appendChild(div);
  });
}

document.getElementById("registroForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const referencias = document.getElementById("referencias").value.trim().split("\n").filter(r => r);
  const cantidades = document.getElementById("cantidades").value.trim().split("\n").map(Number);
  const empaquesDañados = referencias.map((ref, i) => ({
    referencia: ref,
    Burbuja: parseInt(document.querySelector(`[name="burbuja-${i}"]`).value) || 0,
    Roto: parseInt(document.querySelector(`[name="roto-${i}"]`).value) || 0,
    Crudo: parseInt(document.querySelector(`[name="crudo-${i}"]`).value) || 0,
    Quemado: parseInt(document.querySelector(`[name="quemado-${i}"]`).value) || 0,
    Otro: parseInt(document.querySelector(`[name="otro-${i}"]`).value) || 0
  }));

  const data = {
    operario: document.getElementById("operario").value,
    referencias,
    cantidades,
    empaquesDañados,
    anomalia: document.getElementById("anomalia").value,
    descripcionAnomalia: document.getElementById("descripcionAnomalia").value
  };

  const response = await fetch("https://script.google.com/macros/s/AKfycby3r7N79XiQTRTrSpxVIPDPMazYFeUjU7NNc_-qC_XM57Nr9TlqaNAlSC-y1iICegeO/exec", {
    method: "POST",
    body: JSON.stringify(data),
    headers: { "Content-Type": "application/json" }
  });

  const result = await response.json();
  alert(result.message);
});
</script>

